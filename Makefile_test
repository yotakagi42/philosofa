# 元のMakefileの中身を読み込む（これで NAME や SRCS 変数が使える）
include Makefile

# --- テスト用のルールをここに追加 ---

# メモリリークチェック
val: re
	valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes ./$(NAME) 5 800 200 200 7

# データ競合チェック (Helgrind)
hell: re
	valgrind --tool=helgrind ./$(NAME) 5 800 200 200 7

# Thread Sanitizer (コンパイルし直す)
san: fclean
	$(CC) $(CFLAGS) -fsanitize=thread $(SRCS) -o $(NAME)
	./$(NAME) 5 800 200 200 7

# 奇数人テスト
odd: re
	./$(NAME) 5 800 200 200

# 1人死亡テスト
die: re
	./$(NAME) 1 800 200 200

# ★追加: valとhellを一気に実行するルール
test:
	@echo "\n=========================================="
	@echo "    1. MEMORY LEAK CHECK (VALGRIND)"
	@echo "=========================================="
	-$(MAKE) -f Makefile_test val
	@echo "\n=========================================="
	@echo "    2. DATA RACE CHECK (HELGRIND)"
	@echo "=========================================="
	-$(MAKE) -f Makefile_test hell

.PHONY: val hell san odd die test